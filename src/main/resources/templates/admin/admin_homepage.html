<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/static/homepage_user/images/icons/favicon.png"/>
    <title> Home | Admin</title>
    <!-- Favicon -->
    <!--    <link rel="shortcut icon" href="/static/admin_homepage/img/svg/Logo.svg" type="image/x-icon">-->
    <!-- Custom styles -->
    <link rel="stylesheet" href="/static/admin_homepage/css/style.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stat-cards-info__title {
            font-weight: normal; /* Ensure New Employee is not bold */
        }

        .stat-cards-info__num {
            font-weight: normal; /* Ensure the text inside the paragraph is not bold */
        }

        .stat-cards-info__num span {
            font-weight: normal; /* Ensure the "employees" part is not bold */
        }

        .stat-cards-info__num .bold {
            font-weight: bold; /* Ensure the count part is bold */
        }

        .pagination-wrapper {
            text-align: left;
            margin-top: 20px;
        }

        .pagination {
            display: inline-flex;
            padding-left: 0;
            list-style: none;
            border-radius: 0.25rem;
        }

        .pagination .page-item {
            display: inline;
        }

        .pagination .page-link {
            position: relative;
            display: block;
            padding: 0.5rem 0.75rem;
            margin-left: -1px;
            line-height: 1.25;
            color: #007bff;
            background-color: #fff;
            border: 1px solid #dee2e6;
        }

        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
            cursor: auto;
            background-color: #fff;
            border-color: #dee2e6;
        }

        .pagination .page-item.active .page-link {
            z-index: 1;
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }
    </style>
</head>

<body>
<div class="layer"></div>
<!-- ! Body -->
<!--<a class="skip-link sr-only" href="#skip-target">Skip to content</a>-->
<div class="page-flex">
    <!-- ! Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-start">
            <div class="sidebar-head">
                <a th:href="@{/fpt-dorm/admin/home}" class="logo-wrapper" title="Home">
                    <span class="sr-only">Home</span>
                    <span class="icon logo" aria-hidden="true"></span>
                    <div class="logo-text">
                        <span class="logo-title">FPT Dorm</span>
                        <span class="logo-subtitle">ADMIN</span>
                    </div>

                </a>
                <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
                    <span class="sr-only">Toggle menu</span>
                    <span class="icon menu-toggle" aria-hidden="true"></span>
                </button>
            </div>
            <div class="sidebar-body">
                <ul class="sidebar-body-menu">
                    <li>
                        <a th:href="@{/fpt-dorm/admin/home}" class="active"><span class="icon home"
                                                                                  aria-hidden="true"></span>Dashboard</a>
                    </li>
                    <li>
                        <a class="show-cat-btn">
                            <span class="icon folder" aria-hidden="true"></span>Student
                            <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                        </a>
                        <ul class="cat-sub-menu">
                            <li>
                                <a th:href="@{/fpt-dorm/admin/admin_list_student}">All Students</a>
                            </li>
                            <li>
                                <a th:href="@{/fpt-dorm/admin/admin_add_student}">Add new student</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a class="show-cat-btn">
                            <span class="icon folder" aria-hidden="true"></span>Dorm Manage
                            <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                        </a>
                        <ul class="cat-sub-menu">
                            <li>
                                <a th:href="@{/fpt-dorm/admin/view-dorm-list}" class="active">Dorm List</a>
                            </li>
                            <li>
                                <a th:href="@{/fpt-dorm/admin/all-room}">All Rooms</a>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a class="show-cat-btn">
                            <span class="icon folder" aria-hidden="true"></span>News
                            <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                        </a>
                        <ul class="cat-sub-menu">
                            <li>
                                <a th:href="@{/fpt-dorm/admin/view-news}">View News</a>
                            </li>
                            <li>
                                <a th:href="@{/fpt-dorm/admin/add-news}">Add news</a>
                            </li>

                        </ul>
                    </li>

                    <li>
                        <a class="show-cat-btn">
                            <span class="icon folder" aria-hidden="true"></span>Employee
                            <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                        </a>
                        <ul class="cat-sub-menu">
                            <li>
                                <a th:href="@{/fpt-dorm/admin/admin_list_employees}">All Employees</a>
                            </li>
                            <li>
                                <a th:href="@{/fpt-dorm/admin/admin_add_employee}">Add new employee</a>
                            </li>
                        </ul>
                    </li>

                    <li>
                        <a class="show-cat-btn" href="#">
                            <span class="icon folder" aria-hidden="true"></span>Payment
                            <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                        </a>
                        <ul class="cat-sub-menu">
                            <li>
                                <a id="menu-all-payments" class="" th:href="@{/fpt-dorm/admin/admin_payment_list}">All
                                    Payments</a>
                            </li>
                            <li>
                                <a id="menu-payment-request" class="" th:href="@{/fpt-dorm/admin/admin_payment_request}">Payment Request</a>
                            </li>
                        </ul>
                    </li>

                    <li>
                        <a th:href="@{/fpt-dorm/admin/usage-service}">
                            <span class="icon folder" aria-hidden="true"></span>
                            Usage Service
                        </a>
                    </li>

                    <li>
                        <a th:href="@{/fpt-dorm/admin/admin_Resident_History}">
                            <span class="icon folder" aria-hidden="true"></span>
                            Resident History
                        </a>
                    </li>

                    <li>
                        <a th:href="@{admin/admin_list_feedback}">
                            <span class="icon folder" aria-hidden="true"></span>
                            Feedback
                        </a>
                    </li>

                    <li>
                        <a th:href="@{/fpt-dorm/admin/admin_list_complaint}">
                            <span class="icon folder" aria-hidden="true"></span>
                            Complaint
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </aside>
    <div class="main-wrapper">
        <!-- ! Main nav -->
        <nav class="main-nav--bg">
            <div class="container main-nav">
                <div class="main-nav-start">
                </div>
                <div class="main-nav-end">
                    <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
                        <span class="sr-only">Toggle menu</span>
                        <span class="icon menu-toggle--gray" aria-hidden="true"></span>
                    </button>
                    <button class="theme-switcher gray-circle-btn" type="button" title="Switch theme">
                        <span class="sr-only">Switch theme</span>
                        <i class="sun-icon" data-feather="sun" aria-hidden="true"></i>
                        <i class="moon-icon" data-feather="moon" aria-hidden="true"></i>
                    </button>
                    <div class="notification-wrapper">
                        <ul class="users-item-dropdown notification-dropdown dropdown">
                            <li>
                                <a href="#">
                                    <div class="notification-dropdown-icon info">
                                        <i data-feather="check"></i>
                                    </div>
                                    <div class="notification-dropdown-text">
                                        <span class="notification-dropdown__title">System just updated</span>
                                        <span class="notification-dropdown__subtitle">The system has been successfully upgraded. Read more
                  here.</span>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <div class="notification-dropdown-icon danger">
                                        <i data-feather="info" aria-hidden="true"></i>
                                    </div>
                                    <div class="notification-dropdown-text">
                                        <span class="notification-dropdown__title">The cache is full!</span>
                                        <span class="notification-dropdown__subtitle">Unnecessary caches take up a lot of memory space and
                  interfere ...</span>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <div class="notification-dropdown-icon info">
                                        <i data-feather="check" aria-hidden="true"></i>
                                    </div>
                                    <div class="notification-dropdown-text">
                                        <span class="notification-dropdown__title">New Subscriber here!</span>
                                        <span class="notification-dropdown__subtitle">A new subscriber has subscribed.</span>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a class="link-to-page" href="#">Go to Notifications page</a>
                            </li>
                        </ul>
                    </div>
                    <div class="nav-user-wrapper">
                        <button href="#" class="nav-user-btn dropdown-btn" title="My profile" type="button">
                            <span class="sr-only">My profile</span>
                            <span class="nav-user-img">
                                <picture><source srcset="/static/admin_homepage/img/avatar/avatar-illustrated-02.webp"
                                                 type="image/webp"><img
                                        src="/static/admin_homepage/img/avatar/avatar-illustrated-02.png"
                                        alt="User name"></picture>
                              </span>
                        </button>
                        <ul class="users-item-dropdown nav-user-dropdown dropdown">
                            <li><a th:href="@{/fpt-dorm/admin/profile}">Profile</a></li>
                            <li><a th:href="@{/fpt-dorm/user/news}">Home User</a></li>
                            <li><a class="danger" th:href="@{/fpt-dorm/logout}">
                                <i data-feather="log-out" aria-hidden="true"></i>
                                <span>Log out</span>
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
        <!-- ! Main -->

        <div class="main-wrapper">
        <main class="main users chart-page" id="skip-target">
            <div class="container">
                <div class="row stat-cards">
                    <div class="col-md-6 col-xl-3">
                        <article class="stat-cards-item">
                            <div class="stat-cards-icon success">
                                <i data-feather="user" aria-hidden="true"></i>
                            </div>
                            <div class="stat-cards-info">
                                <div class="stat-cards-info__title">New User</div>
                                <p class="stat-cards-info__num">
                                    <span id="newUserCount" class="bold">+0</span>
                                    <span> users</span>
                                </p>
                            </div>
                        </article>
                    </div>


                    <script>
                        async function fetchNewUserCount() {
                            try {
                                const response = await fetch('/count-new-users');
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                const newUserCount = await response.json();
                                document.getElementById('newUserCount').innerText = `+${newUserCount}`;
                            } catch (error) {
                                console.error('There was a problem with the fetch operation:', error);
                            }
                        }

                        document.addEventListener('DOMContentLoaded', (event) => {
                            fetchNewUserCount();
                        });
                    </script>
                    <div class="col-md-6 col-xl-3">
                        <article class="stat-cards-item">
                            <div class="stat-cards-icon success">
                                <i data-feather="alert-circle" aria-hidden="true"></i>
                            </div>
                            <div class="stat-cards-info">
                                <div class="stat-cards-info__title">New Complaints</div>
                                <p class="stat-cards-info__num">
                                    <span id="newComplaintCount" class="bold">+0</span>
                                    <span> complaints</span>
                                </p>
                            </div>
                        </article>
                    </div>


                    <script>
                        async function fetchNewComplaintCount() {
                            try {
                                const response = await fetch('/count-complaints');
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                const newComplaintCount = await response.json();
                                document.getElementById('newComplaintCount').innerText = `+${newComplaintCount}`;
                            } catch (error) {
                                console.error('There was a problem with the fetch operation:', error);
                            }
                        }

                        document.addEventListener('DOMContentLoaded', (event) => {
                            fetchNewComplaintCount();
                        });
                    </script>
                    <div class="col-md-6 col-xl-3">
                        <article class="stat-cards-item">
                            <div class="stat-cards-icon success">
                                <i data-feather="calendar" aria-hidden="true"></i>
                            </div>
                            <div class="stat-cards-info">
                                <div class="stat-cards-info__title">New Booking</div>
                                <p class="stat-cards-info__num">
                                    <span id="newBookingCount" class="bold">+0</span>
                                    <span> bookings</span>
                                </p>
                            </div>
                        </article>
                    </div>

                    <script>
                        async function fetchNewBookingCount() {
                            try {
                                const response = await fetch('/count-bookings');
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                const newBookingCount = await response.json();
                                document.getElementById('newBookingCount').textContent = `+${newBookingCount}`;
                            } catch (error) {
                                console.error('There was a problem with the fetch operation:', error);
                            }
                        }

                        document.addEventListener('DOMContentLoaded', (event) => {
                            fetchNewBookingCount();
                        });
                    </script>
                    <!--                    <script>-->
                    <!--                        async function fetchActiveUsersCount() {-->
                    <!--                            try {-->
                    <!--                                const response = await fetch('/active-users');-->
                    <!--                                if (!response.ok) {-->
                    <!--                                    throw new Error('Network response was not ok');-->
                    <!--                                }-->
                    <!--                                const activeUsersCount = await response.json();-->
                    <!--                                document.getElementById('activeUsersCount').textContent = `${activeUsersCount}`;-->
                    <!--                            } catch (error) {-->
                    <!--                                console.error('There was a problem with the fetch operation:', error);-->
                    <!--                            }-->
                    <!--                        }-->

                    <!--                        document.addEventListener('DOMContentLoaded', (event) => {-->
                    <!--                            fetchActiveUsersCount();-->
                    <!--                        });-->
                    <!--                    </script>-->
                    <!--                    <div class="col-md-6 col-xl-3">-->
                    <!--                        <article class="stat-cards-item">-->
                    <!--                            <div class="stat-cards-icon success">-->
                    <!--                                <i data-feather="check-circle" aria-hidden="true"></i>-->
                    <!--                            </div>-->
                    <!--                            <div class="stat-cards-info">-->
                    <!--                                <div class="stat-cards-info__title">Active Users</div>-->
                    <!--                                <p class="stat-cards-info__num">-->
                    <!--                                    <span id="activeUsersCount" class="bold">0</span>-->
                    <!--                                    <span> active users</span>-->
                    <!--                                </p>-->
                    <!--                            </div>-->
                    <!--                        </article>-->
                    <!--                    </div>-->
                    <div class="col-md-6 col-xl-3">
                        <article class="stat-cards-item">
                            <div class="stat-cards-icon success">
                                <i data-feather="check-circle" aria-hidden="true"></i>
                            </div>
                            <div class="stat-cards-info">
                                <div class="stat-cards-info__title">Used Beds</div>
                                <p class="stat-cards-info__num">
                                    <span id="usedBedsCount" class="bold">0</span>
                                    <span> beds in use</span>
                                </p>
                            </div>
                        </article>
                    </div>

                    <script>
                        async function fetchUsedBedsCount() {
                            try {
                                const response = await fetch('/count-used-beds');
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                const usedBedsCount = await response.json();
                                document.getElementById('usedBedsCount').textContent = `${usedBedsCount}`;
                            } catch (error) {
                                console.error('There was a problem with the fetch operation:', error);
                            }
                        }

                        document.addEventListener('DOMContentLoaded', (event) => {
                            fetchUsedBedsCount();
                        });
                    </script>

                    <script>
                        document.addEventListener("DOMContentLoaded", function() {
                            fetch('/active-users')
                                .then(response => response.json())
                                .then(data => {
                                    document.getElementById('activeUsersCount').textContent = data;
                                })
                                .catch(error => console.error('Error fetching active users count:', error));
                        });
                    </script>
                </div>
                <div class="row" style="text-align: center;">
                    <div class="col-lg-6">
                        <div>
                            <form th:action="@{/fpt-dorm/admin/home}" method="get" class="search-form">
                                <div style="display: flex; align-items: center;">
                                    <select id="year" name="year"
                                            style="margin: 0 8px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        <option value="0">-- Select Year --</option>
                                        <option th:each="year : ${years}"
                                                th:value="${year}"
                                                th:text="${year}"
                                                th:selected="${year == selectedYear}"></option>
                                    </select>
                                    <select id="month" name="month"
                                            style="margin: 0 8px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                        <option value="0">-- Select Month --</option>
                                        <option th:each="month : ${#numbers.sequence(1, 12)}"
                                                th:value="${month}"
                                                th:text="${month}"
                                                th:selected="${month == selectedMonth}"></option>
                                    </select>
                                    <button type="submit" class="btn btn-primary"
                                            style="padding: 8px 20px; background-color: #007bff; border: none; border-radius: 4px; color: white;">
                                        Show Status
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <h2 style="text-align: center; margin-top: 10px;">Dashboard in [[${selectedMonth}]]/[[${selectedYear}]]</h2>
                <div class="row">
                    <div class="col-lg-12" style="background-color: white;">

                        <div style="display: flex; justify-content: center; ">
                            <div style="width: 65%; background-color: white; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; background-color: white; padding: 20px;">
                                    <input type="hidden" id="monthPicker" th:value="${selectedMonth}">
                                    <input type="hidden" id="yearPicker" th:value="${selectedYear}">
                                    <h3 style="text-align: center; margin-top: 10px;">Transaction History</h3>
                                    <div style="margin-left: 50px;" id="totalRevenue"></div>
                                    <div class="chart-container">
                                        <canvas id="transactionChart" aria-label="Transaction statistics"
                                                role="img"></canvas>
                                    </div>
                                </div>

                                <div style="width: 100%; background-color: white; padding: 20px;">
                                    <h3 style="text-align: center;">Usage Service Chart</h3>
                                    <div>Total Revenue of Usage Service: <span
                                            th:text="${totalElectricity + totalWater + totalOthers}"></span> VND
                                    </div>
                                    <div class="chart-container"
                                         style="max-width: 100%; height: auto;">
                                        <canvas id="usageChart" style="height: 100%;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <!-- Container for Booking and Complaint Status Charts -->
                            <div style="width: 35%; background-color: white; padding: 20px; display: flex; flex-direction: column; align-items: center;">

                                <!-- Booking Status Chart -->
                                <div style="width: 100%; background-color: white; padding: 20px; margin-bottom: 20px;">
                                    <h3 style="text-align: center; margin-top: 10px;">Booking Status Chart</h3>
                                    <div class="chart-container" style="max-width: 100%;">
                                        <canvas id="bookingStatusChart"></canvas>
                                    </div>
                                </div>

                                <!-- Complaint Status Chart -->
                                <div style="width: 100%; background-color: white; padding: 20px;">
                                    <h3 style="text-align: center; margin-top: 10px;">Complaint Status Chart</h3>
                                    <div class="chart-container" style="max-width: 100%;">
                                        <canvas id="complaintStatusChart"></canvas>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </main>
        </div>
        <!-- ! Footer -->
        <footer class="footer">
            <div class="container footer--flex">
                <div class="footer-start">
                    <p>2024 © FPT Dorm - <a href="/fpt-dorm/home" target="_blank"
                                            rel="noopener noreferrer">FPT Dorm</a></p>
                </div>
                <ul class="footer-end">
                    <li><a href="/fpt-dorm/home/about">About</a></li>
                    <li><a href="/fpt-dorm/home/contact">Contact</a></li>
                </ul>
            </div>
        </footer>
    </div>
</div>

<!-- Chart library -->
<script src="/static/admin_homepage/plugins/chart.min.js"></script>
<!-- Icons library -->
<script src="/static/admin_homepage/plugins/feather.min.js"></script>
<!-- Custom scripts -->
<script src="/static/admin_homepage/js/script.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function () {
        var ctx = document.getElementById('bookingStatusChart').getContext('2d');
        var statusCounts = /*[[${statusCounts}]]*/ {};
        var labels = Object.keys(statusCounts);
        var data = Object.values(statusCounts);

        // Check if statusCounts is empty or pending = 0
        if (labels.length === 0 || (labels.length === 1 && labels[0] === 'pending' && statusCounts['pending'] === 0)) {
            // If no data or only pending = 0, show a default chart with a single value
            labels = ['No Data'];
            data = [100]; // Displaying 100% as yellow
        }

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                }]
            }
        });
    });
    /*]]>*/
</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function () {
        var Comctx = document.getElementById('complaintStatusChart').getContext('2d');
        var statusComCounts = /*[[${statusComCounts}]]*/ [];
        var labels = statusComCounts.map(function (obj) {
            return obj.status;
        });
        var data = statusComCounts.map(function (obj) {
            return obj.count;
        });

        // Check if statusComCounts is empty
        if (labels.length === 0) {
            labels = ['No Data'];
            data = [100]; // Displaying 100% as yellow
        }

        new Chart(Comctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                }]
            }
        });
    });
    /*]]>*/
</script>
<script>
    /* Data from Controller */
    var totalElectricity = [[${totalElectricity}]];
    var totalWater = [[${totalWater}]];
    var totalOthers = [[${totalOthers}]];

    var usageCtx = document.getElementById('usageChart').getContext('2d');
    var usageChart = new Chart(usageCtx, {
        type: 'bar',
        data: {
            labels: ['Electricity', 'Water', 'Others'],
            datasets: [{
                label: 'Total Cost',
                data: [totalElectricity, totalWater, totalOthers],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
<script>
    const transactionCtx = document.getElementById('transactionChart').getContext('2d');
    const transactionChart = new Chart(transactionCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: 'PayPal',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    fill: false
                },
                {
                    label: 'VNPay',
                    data: [],
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    fill: false
                }
            ]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Transaction History'
            },
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Date'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Amount'
                    }
                }
            }
        }
    });

    async function fetchTransactionData(method, month) {
        try {
            const response = await fetch(`/payments?method=${method}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            console.log(`Fetched data for ${method}:`, data);
            return data.filter(transaction => transaction.paymentDate.startsWith(month));
        } catch (error) {
            console.error(`Error fetching data for ${method}:`, error);
            return [];
        }
    }

    async function updateChart() {
        const selectedMonth = document.getElementById('month').value;
        const selectedYear = document.getElementById('year').value;
        const selectedDate = `${selectedYear}-${('0' + selectedMonth).slice(-2)}`;

        const paypalData = await fetchTransactionData('PayPal', selectedDate);
        const vnpayData = await fetchTransactionData('BankQRCode', selectedDate);

        console.log('Filtered PayPal Data:', paypalData);
        console.log('Filtered VNPay Data:', vnpayData);

        const dates = [];
        const paypalAmounts = [];
        const vnpayAmounts = [];

        const startDate = new Date(`${selectedDate}-01`);
        const endDate = new Date(`${selectedDate}-01`);
        endDate.setMonth(endDate.getMonth() + 1);

        let currentDate = startDate;
        while (currentDate < endDate) {
            const nextDate = new Date(currentDate);
            nextDate.setDate(nextDate.getDate() + 6);

            const periodLabel = `${currentDate.toISOString().slice(0, 10)} to ${nextDate.toISOString().slice(0, 10)}`;
            dates.push(periodLabel);

            const paypalAmount = paypalData
                .filter(transaction => {
                    const transactionDate = new Date(transaction.booking.startDate);
                    return transactionDate >= currentDate && transactionDate < nextDate;
                })
                .reduce((sum, transaction) => sum + parseFloat(transaction.booking.totalPrice), 0);
            paypalAmounts.push(paypalAmount);

            const vnpayAmount = vnpayData
                .filter(transaction => {
                    const transactionDate = new Date(transaction.booking.startDate);
                    return transactionDate >= currentDate && transactionDate < nextDate;
                })
                .reduce((sum, transaction) => sum + parseFloat(transaction.booking.totalPrice), 0);
            vnpayAmounts.push(vnpayAmount);

            console.log(`Period: ${periodLabel}, PayPal Amount: ${paypalAmount}, VNPay Amount: ${vnpayAmount}`);

            currentDate = nextDate;
        }

        // Tính tổng doanh thu
        const totalPaypalRevenue = paypalAmounts.reduce((sum, amount) => sum + amount, 0);
        const totalVnpayRevenue = vnpayAmounts.reduce((sum, amount) => sum + amount, 0);
        const totalRevenue = totalPaypalRevenue + totalVnpayRevenue;

        // Hiển thị tổng doanh thu
        document.getElementById('totalRevenue').innerHTML = `<div>Total Revenue of Booking: ${totalRevenue} VND</div>`;


        // Cập nhật dữ liệu biểu đồ
        transactionChart.data.labels = dates;
        transactionChart.data.datasets[0].data = paypalAmounts;
        transactionChart.data.datasets[1].data = vnpayAmounts;
        transactionChart.update();
    }

    document.addEventListener('DOMContentLoaded', (event) => {
        updateChart();
    });
</script>
</body>

</html>