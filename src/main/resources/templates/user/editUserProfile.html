<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/homepage_user/images/icons/favicon.png"/>
    <title>Profile</title>
    <link href="/homepage_user/css/bootstrap.min.css" rel="stylesheet">
    <link href="/homepage_user/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="/homepage_user/css/style.css" rel="stylesheet">
    <link href="/homepage_user/fonts/antonio-exotic/stylesheet.css" rel="stylesheet">
    <link rel="stylesheet" href="/homepage_user/css/lightbox.min.css">
    <link href="/homepage_user/css/responsive.css" rel="stylesheet">
    <script src="/homepage_user/js/jquery.min.js" type="text/javascript"></script>
    <script src="/homepage_user/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/homepage_user/js/lightbox-plus-jquery.min.js" type="text/javascript"></script>
    <script src="/homepage_user/js/instafeed.min.js" type="text/javascript"></script>
    <script src="/homepage_user/js/custom.js" type="text/javascript"></script>

    <style>
        .form-control {
            line-height: 1.7;
        }

        .form-check-input {
            margin-top: auto;
        }

        .error {
            color: red;
            font-size: 0.9em;
        }

        .error-message {
            color: red;
        }

        .success-message {
            color: green;
        }
    </style>
    <script>
        function validateEmail(email) {
            var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailPattern.test(email);
        }

        function validatePassword(password) {
            var passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{10,}$/;
            return passwordPattern.test(password);
        }

        function validateFullName() {
            var fullname = document.getElementById("fullname").value.trim(); // Loại bỏ các khoảng trắng ở đầu và cuối chuỗi
            var fullnameError = document.getElementById("fullnameError");
            var containsNumber = /[0-9]/.test(fullname); // Kiểm tra xem chuỗi có chứa số không
            var containsOnlySpaces = /^\s*$/.test(fullname); // Kiểm tra xem chuỗi chỉ chứa khoảng trắng không
            var containsConsecutiveSpaces = /\s\s+/.test(fullname); // Kiểm tra xem chuỗi có chứa khoảng trắng liên tiếp không

            if (!fullname || containsNumber || containsOnlySpaces || containsConsecutiveSpaces) {
                if (!fullname) {
                    fullnameError.textContent = "Full Name is required.";
                } else if (containsNumber) {
                    fullnameError.textContent = "Full Name cannot contain numbers.";
                } else if (containsOnlySpaces) {
                    fullnameError.textContent = "Full Name cannot be only spaces.";
                } else {
                    fullnameError.textContent = "Full Name cannot contain consecutive spaces.";
                }
                return false;
            } else {
                fullnameError.textContent = "";
                return true;
            }
        }

        function validateEmailField() {
            var email = document.getElementById("email").value;
            var emailError = document.getElementById("emailError");
            if (!email) {
                emailError.textContent = "Email is required.";
                return false;
            } else if (!validateEmail(email)) {
                emailError.textContent = "Please enter a valid email address.";
                return false;
            } else {
                emailError.textContent = "";
                return true;
            }
        }

        function validatePasswordField() {
            var password = document.getElementById("password").value;
            var passwordError = document.getElementById("passwordError");
            if (!password) {
                passwordError.textContent = "Password is required.";
                return false;
            } else if (!validatePassword(password)) {
                passwordError.textContent = "Password must be at least 10 characters long and include uppercase letters, lowercase letters, numbers, and special characters.";
                return false;
            } else {
                passwordError.textContent = "";
                return true;
            }
        }

        function validateGender() {
            var genderMale = document.querySelector("input[name='gender'][value='Male']").checked;
            var genderFemale = document.querySelector("input[name='gender'][value='Female']").checked;
            var genderOther = document.querySelector("input[name='gender'][value='Other']").checked;
            var genderError = document.getElementById("genderError");
            if (!genderMale && !genderFemale && !genderOther) {
                genderError.textContent = "Gender is required.";
                return false;
            } else {
                genderError.textContent = "";
                return true;
            }
        }

        function validateBirthdate() {
            var birthdate = document.getElementById("birthdate").value;
            var birthdateError = document.getElementById("birthdateError");
            if (!birthdate) {
                birthdateError.textContent = "Birth Date is required.";
                return false;
            } else {
                birthdateError.textContent = "";
                return true;
            }
        }

        function validatePhone() {
            var phone = document.getElementById("phone").value;
            var phoneError = document.getElementById("phoneError");
            var phoneRegex = /^[0-9]+$/;

            if (!phone) {
                phoneError.textContent = "Phone number is required.";
                return false;
            } else if (phone.includes(" ")) {
                phoneError.textContent = "Phone number must not contain spaces.";
                return false;
            } else if (!phoneRegex.test(phone)) {
                phoneError.textContent = "Phone number must contain only numbers.";
                return false;
            } else {
                phoneError.textContent = "";
                return true;
            }
        }

        function validateAddress() {
            var address = document.getElementById("address").value;
            var addressError = document.getElementById("addressError");
            if (!address) {
                addressError.textContent = "Address is required.";
                return false;
            } else {
                addressError.textContent = "";
                return true;
            }
        }

        function validateIDCard() {
            var idcard = document.getElementById("idcard").value;
            var idcardError = document.getElementById("idcardError");
            if (!idcard) {
                idcardError.textContent = "Vietnamese Citizen ID Card is required.";
                return false;
            } else {
                idcardError.textContent = "";
                return true;
            }
        }

        function validateAvatar() {
            var avatar = document.getElementById("avatar").files.length;
            var avatarError = document.getElementById("avatarError");
            if (avatar === 0) {
                avatarError.textContent = "Avatar is required.";
                return false;
            } else {
                avatarError.textContent = "";
                return true;
            }
        }

        function validateFrontFace() {
            var frontface = document.getElementById("frontface").files.length;
            var frontfaceError = document.getElementById("frontfaceError");
            if (frontface === 0) {
                frontfaceError.textContent = "Front face ID card is required.";
                return false;
            } else {
                frontfaceError.textContent = "";
                return true;
            }
        }

        function validateBackFace() {
            var backface = document.getElementById("backface").files.length;
            var backfaceError = document.getElementById("backfaceError");
            if (backface === 0) {
                backfaceError.textContent = "Back face ID card is required.";
                return false;
            } else {
                backfaceError.textContent = "";
                return true;
            }
        }

        function addValidationListeners() {
            document.getElementById("fullname").addEventListener("blur", validateFullName);
            document.getElementById("email").addEventListener("blur", validateEmailField);
            document.getElementById("password").addEventListener("blur", validatePasswordField);
            document.querySelectorAll("input[name='gender']").forEach(input => input.addEventListener("blur", validateGender));
            document.getElementById("birthdate").addEventListener("blur", validateBirthdate);
            document.getElementById("phone").addEventListener("blur", validatePhone);
            document.getElementById("address").addEventListener("blur", validateAddress);
            document.getElementById("avatar").addEventListener("change", validateAvatar);
            document.getElementById("idcard").addEventListener("blur", validateIDCard);
            document.getElementById("frontface").addEventListener("change", validateFrontFace);
            document.getElementById("backface").addEventListener("change", validateBackFace);
        }

        document.addEventListener("DOMContentLoaded", addValidationListeners);

        function validateForm() {
            var isValid = true;

            if (!validateFullName()) isValid = false;
            if (!validateEmailField()) isValid = false;
            if (!validatePasswordField()) isValid = false;
            if (!validateGender()) isValid = false;
            if (!validateBirthdate()) isValid = false;
            if (!validatePhone()) isValid = false;
            if (!validateAddress()) isValid = false;
            if (!validateIDCard()) isValid = false;
            if (!validateAvatar()) isValid = false;
            if (!validateFrontFace()) isValid = false;
            if (!validateBackFace()) isValid = false;

            return isValid;
        }

        document.addEventListener("DOMContentLoaded", function () {
            flatpickr('.flatpickr-input', {
                dateFormat: "Y-m-d",
            });
        });
        document.addEventListener('DOMContentLoaded', function () {
            const A = document.getElementById('menu-student');
            const B = document.getElementById('menu-all-students');

            A.addEventListener('click', function () {
                if (A.classList.contains('active')) {
                    A.classList.remove('active');
                    B.classList.add('active');
                } else {
                    A.classList.add('active');
                    B.classList.remove('active');
                }
            });
        });
    </script>
</head>

<body>
<div id="page">
    <!---header top---->
    <div class="top-header">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                </div>
            </div>
        </div>
    </div>
    <!--header--->
    <header class="header-container">
        <div class="container">
            <div class="top-row">
                <div class="row">
                    <div class="col-md-2 col-sm-6 col-xs-6">
                        <div id="logo">
                            <a th:href="@{/fpt-dorm/home}"><span>FPT</span>Dorm</a>
                        </div>
                    </div>
                    <div class="col-md-8 col-sm-12 col-xs-12 remove-padd">
                        <nav class="navbar navbar-default">
                            <div class="navbar-header page-scroll">
                                <button data-target=".navbar-ex1-collapse" data-toggle="collapse" class="navbar-toggle"
                                        type="button">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>
                            <div class="collapse navigation navbar-collapse navbar-ex1-collapse remove-space">
                                <ul class="list-unstyled nav1 cl-effect-10">
                                    <li><a data-hover="News" th:href="@{/fpt-dorm/user/news}"><span>News</span></a></li>
                                    <li><a data-hover="Booking"
                                           th:href="@{/fpt-dorm/user/booking}"><span>Booking</span></a></li>
                                    <li><a data-hover="Available beds"
                                           th:href="@{/fpt-dorm/user/detail-dorm}"><span>Available beds</span></a>
                                    </li>
                                    <li><a data-hover="Usage service"
                                           th:href="@{/fpt-dorm/user/usage-service}"><span>Usage service</span></a>
                                    </li>
                                    <li><a data-hover="Payment"
                                           th:href="@{/fpt-dorm/user/payment}"><span>Payment</span></a></li>
                                    <li><a data-hover="Resident History"
                                           th:href="@{/fpt-dorm/user/resident-history/list}"><span>Resident History</span></a>
                                    </li>
                                    <li><a data-hover="Request"
                                           th:href="@{/fpt-dorm/user/my-request}"><span>Request</span></a>
                                    </li>
                                    <li><a data-hover="Dormitory rules" th:href="@{/fpt-dorm/user/rule}"><span>Dormitory rules</span></a>
                                    </li>
                                    <li><a data-hover="FAQ" th:href="@{/fpt-dorm/user/faq}"><span>FAQ</span></a>
                                    </li>
                                </ul>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="main-wrapper">
        <!-- ! Main -->
        <main class="main users chart-page" id="skip-target">
            <div class="container">

                <div class="row">

                    <div class="col-md-8 col-lg-8 mx-auto border p-4 m-4 white-block">
                        <h2 class="main-title text-center">Update Profile</h2>
                        <form th:action="@{/fpt-dorm/user/update-user-profile}" method="post"
                              enctype="multipart/form-data" th:object="${user}" onsubmit="return validateForm()">
                            <input type="hidden" name="userId" th:value="${user.userId}">
                            <div class="row mb-3">
                                <label for="fullname" class="col-sm-4 col-form-label">Name</label>
                                <div class="col-sm-8">
                                    <input id="fullname" name="username" class="form-control border"
                                           th:field="*{username}">
                                    <div id="fullnameError" class="error"></div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label for="email" class="col-sm-4 col-form-label">Email</label>
                                <div class="col-sm-8">
                                    <input id="email" readonly class="form-control border" th:field="*{email}"
                                           type="email">
                                    <div id="emailError" class="error"></div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label for="idcard" class="col-sm-4 col-form-label">Citizen identification card</label>
                                <div class="col-sm-8">
                                    <input id="idcard" name="cccdNumber" class="form-control border " readonly
                                           th:field="*{cccdNumber}">
                                    <div id="idcardError" class="error"></div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <label for="phone" class="col-sm-4 col-form-label">Phone Number</label>
                                <div class="col-sm-8">
                                    <input type="number" id="phone" class="form-control border"
                                           th:field="*{phoneNumber}">
                                    <div id="phoneError" class="error"></div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="offset-sm-4 col-sm-8">
                                    <img th:src="${user.avatar}" th:alt="*{avatar}" width="150">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label for="avatar" class="col-sm-4 col-form-label">Avatar Upload</label>
                                <div class="col-sm-8">
                                    <input id="avatar" name="avatar" class="form-control border" type="file" multiple
                                           th:field="*{avatar}">
                                    <div id="avatarError" class="error"></div>
                                </div>
                            </div>

                            <div class="row mb-3 align-items-center">
                                <label class="col-sm-4 col-form-label">Gender</label>
                                <div class="col-sm-8">
                                    <div class="form-check form-check-inline">
                                        <input id="genderMale" name="gender" class="form-check-input border"
                                               type="radio" th:field="*{gender}" value="Male"/>
                                        <label for="genderMale" class="form-check-label">Male</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input id="genderFemale" name="gender" class="form-check-input border"
                                               type="radio" th:field="*{gender}" value="Female"/>
                                        <label for="genderFemale" class="form-check-label">Female</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input id="genderOther" name="gender" class="form-check-input border"
                                               type="radio" th:field="*{gender}" value="Other"/>
                                        <label for="genderOther" class="form-check-label">Other</label>
                                    </div>
                                    <div id="genderError" class="error"></div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label for="birthdate" class="col-sm-4 col-form-label">Birth Date</label>
                                <div class="col-sm-8">
                                    <input id="birthdate" name="birthdate" class="form-control border flatpickr-input"
                                           type="date" th:value="*{birthdate}">
                                    <div id="birthdateError" class="error"></div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label for="address" class="col-sm-4 col-form-label">Address</label>
                                <div class="col-sm-8">
                                    <textarea id="address" name="address" class="form-control"
                                              th:field="*{address}"></textarea>
                                    <div id="addressError" class="error"></div>
                                </div>
                            </div>


                            <div class="row mb-3" style="display: none;">
                                <div class="offset-sm-4 col-sm-8">
                                    <img th:src="${user.frontCccdImage}" th:alt="*{frontCccdImage}" width="150">
                                </div>
                            </div>
                            <div class="row mb-3" style="display: none;">
                                <label for="frontface" class="col-sm-4 col-form-label">Front CCCD Upload</label>
                                <div class="col-sm-8">
                                    <input id="frontface" name="frontface" class="form-control border" type="file">
                                    <div id="frontfaceError" class="error"></div>
                                </div>
                            </div>

                            <div class="row mb-3" style="display: none;">
                                <div class="offset-sm-4 col-sm-8">
                                    <img th:src="${user.backCccdImage}" th:alt="*{backCccdImage}" width="150">
                                </div>
                            </div>
                            <div class="row mb-3" style="display: none;">
                                <label for="backface" class="col-sm-4 col-form-label">Back CCCD Upload</label>
                                <div class="col-sm-8">
                                    <input id="backface" name="backface" class="form-control border" type="file">
                                    <div id="backfaceError" class="error"></div>
                                </div>
                            </div>

                            <div class="row" style="margin-top: 50px;">
                                <div class="col-sm-4 d-grid">
                                    <button type="submit" class="btn primary-default-btn" role="button">Save</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>

        <style>
            .zapier-modal {
                position: fixed;
                top: 50%;
                right: 0;
                transform: translateY(-50%);
                width: 480px;
                height: 100vh;
                max-height: 100vh;
                background: white;
                border: 1px solid #ccc;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                display: none;
            }
            .zapier-modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0 15px;
                height: 50px;
                background: #f5f5f5;
                border-bottom: 1px solid #ccc;
                border-top-left-radius: 10px;
                border-top-right-radius: 10px;
            }
            .zapier-modal-header .header-title {
                font-size: 21px;
                margin: 0;
            }
            .zapier-modal-header button {

                background: none;
                border: none;
                font-size: 40px;
                cursor: pointer;
            }
            .zapier-modal-content {
                padding: 0;
                height: calc(100% - 40px);
            }
            .zapier-modal-open-icon {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #ff4157;
                color: white;
                border: none;
                border-radius: 50%;
                width: 60px;
                height: 60px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                cursor: pointer;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                z-index: 999;
            }
        </style>

        <!-- Modal Structure -->
        <div class="zapier-modal" id="zapier-modal">
            <div class="zapier-modal-header">
                <h1 class="header-title">Chat with us</h1>
                <button id="close-modal">&times;</button>
            </div>
            <div class="zapier-modal-content">
                <script type='module'
                        src='https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js'></script>
                <zapier-interfaces-page-embed page-id='clyk97vvi000nqe05q0vtzmx4' no-background='false'
                                              allow-query-params='true' query-params=''
                                              style='max-width: 900px; height: 120vh;'></zapier-interfaces-page-embed>
            </div>
        </div>

        <!-- Icon to open the modal -->
        <button class="zapier-modal-open-icon" id="open-modal">
            <i class="fa fa-comments"></i>
        </button>

        <script>
            $(document).ready(function () {
                var modal = $('#zapier-modal');
                var openBtn = $('#open-modal');
                var closeBtn = $('#close-modal');

                openBtn.on('click', function () {
                    modal.show();
                });

                closeBtn.on('click', function () {
                    modal.hide();
                });
            });
        </script>

        <!-- Footer Section -->
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-5 col-sm-6 col-xs-12 width-set-50">
                        <div class="footer-details">
                            <h4>Get in touch</h4>
                            <ul class="list-unstyled footer-contact-list">
                                <li>
                                    <i class="fa fa-map-marker fa-lg"></i>
                                    <p>Education and Training Area - Hoa Lac High-Tech Park - Km29 Thang Long Avenue, Thach That, City. HN</p>
                                </li>
                                <li>
                                    <i class="fa fa-phone fa-lg"></i>
                                    <p><a href="tel:+842473001866"> (024) 7300.1866 / (024) 7300.5588</a></p>
                                </li>
                                <li>
                                    <i class="fa fa-envelope-o fa-lg"></i>
                                    <p><a href="mailto:daihocfpt@fpt.edu.vn"> daihocfpt@fpt.edu.vn</a></p>
                                </li>
                            </ul>

                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6 col-xs-12 width-50 width-set-50">
                        <div class="footer-details">
                            <h4>explore</h4>
                            <ul class="list-unstyled footer-links">
                                <li><a th:href="@{/fpt-dorm/home}">Home</a></li>
                                <li><a th:href="@{/fpt-dorm/home/about}">About</a></li>
                                <li><a th:href="@{/fpt-dorm/home/room}">Rooms</a></li>
                                <li><a th:href="@{/fpt-dorm/home/gallery}">Gallery</a></li>
                                <li><a th:href="@{/fpt-dorm/home/dinning}">Dinning</a></li>
                                <li> <a th:href="@{/fpt-dorm/home/contact}">Contact</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <div class="footer-details">
                            <h4>Now On Instagram</h4>
                            <div class="row">
                                <div class="instagram-images">
                                    <div id="instafeed"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="copyright">
                    &copy; 2024 All right reserved. Designed by <a href="http://localhost:8080/fpt-dorm/home" target="_blank">SWP391</a>
                </div>

            </div>

        </footer>

        <!--back to top--->
        <a style="display: none;" href="javascript:void(0);" class="scrollTop back-to-top" id="back-to-top">
            <span><i aria-hidden="true" class="fa fa-angle-up fa-lg"></i></span>
            <span>Top</span>
        </a>
    </div>
</div>
</body>
</html>
